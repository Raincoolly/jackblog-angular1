!function(){"use strict";angular.module("jackblog",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap","ngLodash","ngProgress","toaster","ngFileUpload","jackblog.resources","jackblog.service","jackblog.filter","jackblog.directives","jackblog.article","jackblog.settings","jackblog.mobile"]).config(["$logProvider","$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","IsDebug",function(t,e,n,o,r,i){o.html5Mode(!0),r.defaults.timeout=5e5,r.defaults.withCredentials=!0,r.interceptors.push("AuthInterceptor"),t.debugEnabled(i),n.otherwise("/")}]).run(["$rootScope","ngProgressFactory","$state","lodash","Auth","Blog","$cookies","CustomModalService","toaster","CookieConfig",function(t,e,n,o,r,i,a,s,c,u){t.default_avatar="/assets/images/avatar.png",i.getIndexImage().then(function(e){t.indexImg=e.img})["catch"](function(){t.indexImg="/assets/images/shanghai.jpg"}),t.opneSnsModal=function(){s.open("SnsSignInCtrl","app/settings/sns_sign_in.html")},t.progressbar=e.createInstance();var l=["/signin","/signup"],g=function(t){return o.find(l,function(e){return o.startsWith(t,e)})};t.$on("$stateChangeStart",function(e,o){t.progressbar.setColor("green"),t.progressbar.reset(),t.progressbar.start(),r.isLoggedInAsync(function(t){g(o.url)&&t?(e.preventDefault(),n.go("home")):o.onlyAdmin&&!r.isAdmin()?(e.preventDefault(),n.go("home")):o.onlyUser&&!t&&(e.preventDefault(),n.go("home"))})}),t.$on("$stateChangeSuccess",function(e,n,o,r,i){t.progressbar.complete(),t.previousState=r,t.previousParams=i}),t.$on("$locationChangeSuccess",function(e,n,o){t.currentUrl=n,t.previousUrl=o;var r=a.get("snsmsg");r&&(r=JSON.parse(r),c.pop(r.msgtype,"",r.msg),a.remove("snsmsg",u))}),t.$on("$stateChangeError",function(){t.progressbar.reset()})}])}(),function(){"use strict";angular.module("jackblog").controller("SidebarCtrl",["$scope",function(t){t.name="Jack Hu"}])}(),function(){"use strict";angular.module("jackblog.service",[])}(),function(){"use strict";angular.module("jackblog.service").factory("CustomModalService",["$modal",function(t){return{open:function(e,n,o){t.open({templateUrl:n,controller:e,size:o})}}}])}(),function(){"use strict";angular.module("jackblog.service").factory("Auth",["$location","$rootScope","$http","User","$cookies","$q","lodash","$window","ServerUrl","CookieConfig",function(t,e,n,o,r,i,a,s,c,u){var l={};return r.get("token")&&(l=o.get()),{login:function(t,e){var a=e||angular.noop,s=i.defer();return n.post(c+"/auth/local",{email:t.email,password:t.password,captcha:t.captcha}).success(function(t){return r.put("token",t.token,u),l=o.get(),s.resolve(t),a()}).error(function(t){return this.logout(),s.reject(t),a(t)}.bind(this)),s.promise},snsLogin:function(t,e){var n=c+"/auth/"+t+"?redirectUrl="+(e||"/");r.get("token")&&(n+="&access_token="+r.get("token").replace(/(^\")|(\"$)/g,"")),s.location.href=n},logout:function(){r.remove("token",u),l={}},getCurrentUser:function(){return l},isLoggedIn:function(){return l.hasOwnProperty("role")},isLoggedInAsync:function(t){l.hasOwnProperty("$promise")?l.$promise.then(function(){t(!0)})["catch"](function(){t(!1)}):t(l.hasOwnProperty("role")?!0:!1)},isLike:function(t){var e=a.findIndex(l.likes,function(e){return e.toString()===t});return-1!==e?!0:!1},isAdmin:function(){return"admin"===l.role},getToken:function(){return r.get("token")}}}])}(),function(){"use strict";angular.module("jackblog.service").factory("AuthInterceptor",["$rootScope","$q","$cookies","$location","$injector",function(t,e,n,o,r){var i;return{request:function(t){return t.headers=t.headers||{},n.get("token")&&(t.headers.Authorization="Bearer "+n.get("token").replace(/(^\")|(\"$)/g,"")),t},response:function(t){return t},responseError:function(t){return 401===t.status?(i=r.get("Auth"),i.logout(),o.path("/signin"),e.reject(t)):e.reject(t)}}}])}(),function(){"use strict";angular.module("jackblog.resources",["ngResource"])}(),function(){"use strict";angular.module("jackblog.resources").factory("User",["$resource","ServerUrl",function(t,e){var n=t(e+"/users/:id/:controller",{id:"@_id"},{getCaptcha:{method:"GET",params:{id:"getCaptcha"}},get:{method:"GET",params:{id:"me"}},mdUser:{method:"PUT",params:{id:"mdUser"}},getUserProvider:{method:"GET",params:{id:"getUserProvider"}},snsLogins:{method:"GET",params:{id:"snsLogins"}}});return{get:n.get,getCaptcha:function(t){var e=t||angular.noop;return n.getCaptcha(function(t){return e(t)},function(t){return e(t)}).$promise},mdUser:function(t,e){var o=e||angular.noop;return n.mdUser(t,function(t){return o(t)},function(t){return o(t)}).$promise},getUserProvider:function(t){var e=t||angular.noop;return n.getUserProvider(function(t){return e(t)},function(t){return e(t)}).$promise},getLogins:function(t){var e=t||angular.noop;return n.snsLogins(function(t){return e(t)},function(t){return e(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Tags",["$resource","ServerUrl",function(t,e){var n=t(e+"/tags/:id/:controller",{id:"@_id"},{getFrontTagList:{method:"GET",params:{id:"getFrontTagList"}}});return{getFrontTagList:function(t){var e=t||angular.noop;return n.getFrontTagList(function(t){return e(t)},function(t){return e(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Mobile",["$resource","ServerUrl",function(t,e){var n=t(e+"/mobile/:id/:controller",{id:"@_id"},{getApps:{method:"GET",params:{id:"getApps"}}});return{getApps:function(t){var e=t||angular.noop;return n.getApps(function(t){return e(t)},function(t){return e(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Comment",["$resource","ServerUrl",function(t,e){var n=t(e+"/comment/:id/:controller",{id:"@_id"},{getFrontCommentList:{method:"GET",params:{controller:"getFrontCommentList"}},addNewComment:{method:"POST",params:{id:"addNewComment"}},addNewReply:{method:"POST",params:{controller:"addNewReply"}},delReply:{method:"PUT",params:{controller:"delReply"}}});return{addNewComment:function(t,e){var o=e||angular.noop;return n.addNewComment(t,function(t){return o(t)},function(t){return o(t)}).$promise},getFrontCommentList:function(t,e){var o=e||angular.noop;return n.getFrontCommentList(t,function(t){return o(t)},function(t){return o(t)}).$promise},addNewReply:function(t,e,o){var r=o||angular.noop;return n.addNewReply({id:t},e,function(t){return r(t)},function(t){return r(t)}).$promise},delComment:function(t,e){var o=e||angular.noop;return n.remove(t,function(t){return o(t)},function(t){return o(t)}).$promise},delReply:function(t,e,o){var r=o||angular.noop;return n.delReply({id:t},e,function(t){return r(t)},function(t){return r(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog.resources").factory("Blog",["$resource","ServerUrl",function(t,e){var n=t(e+"/article/:id/:controller",{id:"@_id"},{getFrontBlogList:{method:"GET",params:{id:"getFrontArticleList"}},getFrontBlogCount:{method:"GET",params:{id:"getFrontArticleCount"}},getFrontArticle:{method:"GET",params:{controller:"getFrontArticle"}},getIndexImage:{method:"GET",params:{id:"getIndexImage"}},toggleLike:{method:"PUT",params:{controller:"toggleLike"}},getPrenext:{method:"GET",params:{controller:"getPrenext"}}});return{getFrontBlogList:function(t,e){var o=e||angular.noop;return n.getFrontBlogList(t,function(t){return o(t)},function(t){return o(t)}).$promise},getFrontBlogCount:function(t,e){var o=e||angular.noop;return n.getFrontBlogCount(t,function(t){return o(t)},function(t){return o(t)}).$promise},getFrontArticle:function(t,e){var o=e||angular.noop;return n.getFrontArticle(t,function(t){return o(t)},function(t){return o(t)}).$promise},getIndexImage:function(t){var e=t||angular.noop;return n.getIndexImage(function(t){return e(t)},function(t){return e(t)}).$promise},toggleLike:function(t,e){var o=e||angular.noop;return n.toggleLike(t,{},function(t){return o(t)},function(t){return o(t)}).$promise},getPrenext:function(t,e){var o=e||angular.noop;return n.getPrenext(t,function(t){return o(t)},function(t){return o(t)}).$promise}}}])}(),function(){"use strict";angular.module("jackblog").controller("NavbarCtrl",["$rootScope","$scope","$state","$location","Auth","lodash",function(t,e,n,o,r,i){e.isLoggedIn=r.isLoggedIn,e.isAdmin=r.isAdmin,e.getCurrentUser=r.getCurrentUser,e.logout=function(){r.logout(),n.go("home",{},{reload:!0})},e.changeMode=function(){t.dayMode=!t.dayMode},e.isActive=function(t){return"/"===t?"/apps"!==o.path():i.startsWith(o.path(),t)}}])}(),function(){"use strict";angular.module("jackblog").controller("FooterCtrl",["$scope",function(t){t.beian="©2015 / 鄂ICP备15010989号-1"}])}(),function(){"use strict";angular.module("jackblog.filter",[]).filter("userStatus",function(){return function(t){var e;switch(t){case 0:e="未验证";break;case 1:e="已验证";break;case 2:e="被阻止";break;default:e="未知状态"}return e}}).filter("customTime",function(){var t=(new Date).getTime(),e=6e4,n=60*e,o=24*n,r=30*o,i=12*r;return function(a){var s,c=new Date(a).getTime(),u=parseInt(t)-parseInt(c);return s=u>=i?parseInt(u/i)+"年前":i>u&&u>=r?parseInt(u/r)+"月前":r>u&&u>=o?parseInt(u/o)+"天前":o>u&&u>=n?parseInt(u/n)+"小时前":n>u&&u>=e?parseInt(u/e)+"分钟前":"刚刚"}})}(),function(){"use strict";angular.module("jackblog.directives",[])}(),function(){"use strict";angular.module("jackblog.directives").directive("email",function(){return{require:["ngModel","^?form"],link:function(t,e,n,o){var r=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;o[0].$parsers.unshift(function(t){return r.test(t)?(o[0].$setValidity("email",!0),t):void o[0].$setValidity("email",!1)})}}}).directive("nickname",function(){return{require:"ngModel",link:function(t,e,n,o){var r=/^[(\u4e00-\u9fa5)0-9a-zA-Z\_\s@]+$/;o.$parsers.unshift(function(t){return r.test(t)?(o.$setValidity("nickname",!0),t):void o.$setValidity("nickname",!1)})}}})}(),function(){"use strict";angular.module("jackblog.directives").directive("scrolltop",["$window",function(t){return{restrict:"EA",replace:!0,template:'<div class="gotop" ng-show="isShowTop"><i class="fa fa-arrow-up"></i></div>',link:function(e,n,o){e.isShowTop=!1;var r=$("html,body");n.bind("click",function(){0===$(window).scrollTop()||r.is(":animated")||r.animate({scrollTop:0},"slow")}),angular.element(t).bind("scroll",function(){this.pageYOffset>=200?e.isShowTop=!0:e.isShowTop=!1,e.$apply()})}}}])}(),function(){"use strict";angular.module("jackblog.settings",[]).config(["$stateProvider",function(t){t.state("signin",{url:"/signin",templateUrl:"app/settings/local_sign_in.html",controller:"LocalSignInCtrl"}).state("setting",{url:"/setting",templateUrl:"app/settings/user_setting.html",controller:"SettingCtrl",onlyUser:!0})}])}(),function(){"use strict";angular.module("jackblog.settings").controller("SettingCtrl",["$scope","User","Auth","toaster","$state",function(t,e,n,o,r){t.user=e.get(),t.mdUser=function(n){n.$valid&&e.mdUser(t.user).then(function(e){t.user=e.data,o.pop("success","","修改资料成功")})["catch"](function(t){t=t.data.error_msg||"修改用户失败",o.pop("error","",t),r.reload()})}}])}(),function(){"use strict";angular.module("jackblog.settings").controller("SnsSignInCtrl",["$rootScope","$scope","Auth",function(t,e,n){e.loginOauth=function(e){n.snsLogin(e,t.currentUrl)}}])}(),function(){"use strict";angular.module("jackblog.settings").directive("snsloginbtns",["$rootScope","User",function(t,e){return{restrict:"E",templateUrl:"app/settings/sns_login_btn.html",replace:!0,link:function(t,n,o){e.getLogins().then(function(e){t.loginBtns=e.data})}}}])}(),function(){"use strict";angular.module("jackblog.settings").controller("LocalSignInCtrl",["$rootScope","$scope","Auth","$state","$log","toaster","$cookies","ServerUrl","CookieConfig",function(t,e,n,o,r,i,a,s,c){function u(){e.captchaUrl=s+"/users/getCaptcha?"+Math.random()}function l(){n.login({email:e.user.email,password:e.user.password,captcha:e.user.captcha}).then(function(){i.pop("success","","登录成功,欢迎光临!"),o.go("home")})["catch"](function(t){e.user.captcha="",u(),t=t.error_msg||t.data.error_msg||"登录失败,请重试",i.pop("error","",t),a.remove("token",c)})}e.loginOauth=function(e){n.snsLogin(e,t.previousUrl)},u(),e.changeCaptcha=function(){u()},e.user={},e.login=function(t){t.$valid&&l()},e.loginPress=function(t,e){13===t.which&&e.$valid&&(t.preventDefault(),l())}}])}(),function(){"use strict";angular.module("jackblog.mobile",[]).config(["$stateProvider",function(t){t.state("apps",{url:"/apps",templateUrl:"app/mobile/mobile.html",controller:"MobileCtrl"})}])}(),function(){"use strict";angular.module("jackblog.mobile").controller("MobileCtrl",["$scope","Mobile",function(t,e){e.getApps().then(function(e){t.apps=e.data})}])}(),function(){"use strict";angular.module("jackblog").config(["$stateProvider",function(t){t.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl",controllerAs:"main"})}])}(),function(){"use strict";angular.module("jackblog").controller("MainCtrl",["$scope","Blog","$log","Tags",function(t,e,n,o){function r(n,o){t.isLoading=!0,e.getFrontBlogCount(n).then(function(e){t.blogCount=e.count,t.numPages=Math.ceil(t.blogCount/t.options.itemsPerPage)}),e.getFrontBlogList(n).then(function(e){t.isLoading=!1,o?t.blogList=e.data:t.blogList=t.blogList.concat(e.data)})["catch"](function(){t.isLoading=!1,t.blogList=[]})}if(o.getFrontTagList().then(function(e){t.tagList=e.data}),t.options={currentPage:1,itemsPerPage:10,sortName:"publish_time",tagId:""},localStorage.options){var i=JSON.parse(localStorage.options);t.options.sortName=i.sortName,t.options.tagId=i.tagId}t.blogList=[],r(t.options),t.loadMore=function(){t.options.currentPage++,r(t.options)},t.changeSort=function(e){t.options.currentPage=1,t.options.tagId="",t.options.sortName=e,localStorage.options=JSON.stringify(t.options),r(t.options,!0)},t.changeTag=function(e){t.options.currentPage=1,t.options.tagId=e,t.options.sortName="",localStorage.options=JSON.stringify(t.options),r(t.options,!0)}}])}(),function(){"use strict";angular.module("jackblog.article",[]).config(["$stateProvider",function(t){t.state("article",{url:"/article/:aid",templateUrl:"app/article/article.html",controller:"ArticleCtrl"})}])}(),function(){"use strict";angular.module("jackblog.article").directive("reply",["Comment","$log","toaster",function(t,e,n){return{restrict:"EA",templateUrl:"app/article/reply.directive.html",replace:!0,link:function(o,r,i){o.delReply=function(r,i,a){confirm("你确定要删除这条回复吗?")&&t.delReply(i,{rid:r}).then(function(t){e.debug(t),o.commentList[a]=t.data})["catch"](function(t){t=t.data.error_msg||"删除回复失败.",n.pop("error","",t)})}}}}])}(),function(){"use strict";angular.module("jackblog.article").directive("comment",["$rootScope","Comment","$timeout","$log","toaster","Auth",function(t,e,n,o,r,i){return{restrict:"E",templateUrl:"app/article/comment.directive.html",replace:!0,link:function(o,a,s){o.showReply=function(e,r){i.isLoggedInAsync(function(i){i?(o.isReply=!o.isReply,$("#replyContent"+e).val("@"+r+" "),n(function(){$("#replyContent"+e).focus()},0,!1)):t.opneSnsModal()})},o.submitNewReply=function(t,n,i){e.addNewReply(t,{content:n}).then(function(t){o.commentList[i].replys=t.data,o.isReply=!o.isReply})["catch"](function(t){t=t.data.error_msg||"添加回复失败.",r.pop("error","",t)})},o.delComment=function(t,n){confirm("删除评论会一起删除它所有回复,你确定要删除吗?")&&e.delComment({id:n}).then(function(){o.commentList.splice(t,1),r.pop("success","","删除评论成功.")})["catch"](function(t){t=t.data.error_msg||"删除评论失败.",r.pop("error","",t)})}}}}])}(),function(){"use strict";angular.module("jackblog.article").controller("ArticleCtrl",["$rootScope","$scope","$log","$state","$location","lodash","toaster","Auth","Blog","Comment","$stateParams",function(t,e,n,o,r,i,a,s,c,u,l){e.aid=l.aid,e.aid||o.go("home"),e.isAdmin=s.isAdmin,e.isLoggedIn=s.isLoggedIn,c.getFrontArticle({id:e.aid}).then(function(t){e.article=t.data}).then(function(){var t={id:e.aid,sortName:"publish_time",tagId:""};localStorage.options&&(t=i.merge(t,JSON.parse(localStorage.options))),c.getPrenext(t).then(function(t){e.next=t.data.next||{},e.prev=t.data.prev||{}})})["catch"](function(){o.go("home")}),u.getFrontCommentList({id:e.aid}).then(function(t){e.commentList=t.data})["catch"](function(t){n.debug(t),e.commentList=[]}),s.isLoggedInAsync(function(t){t?e.isLike=s.isLike(e.aid):e.isLike=!1}),e.newComment={content:""},e.submitNewComment=function(t){e.newComment.aid=t,u.addNewComment(e.newComment).then(function(t){e.commentList.push(t.data),e.newComment.content=""})["catch"](function(t){n.debug(t),a.pop("error","","评论添加错误,请重试.")})},e.goToComment=function(e){s.isLoggedInAsync(function(n){n?$("#"+e).focus():t.opneSnsModal()})},e.toggleLike=function(n){s.isLoggedInAsync(function(o){o?c.toggleLike({id:n}).then(function(t){e.article.like_count=t.count,e.isLike=t.isLike}):t.opneSnsModal()})}}])}(),function(){return angular.module("jackblog").constant("ServerUrl","https://api.jackhu.top").constant("IsDebug",!1).constant("CookieConfig",{domain:".jackhu.top"})}();